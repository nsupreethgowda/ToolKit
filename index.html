<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NeuroToolkit</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0f766e">
  <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@2/css/pico.min.css">

  <style>
    body {
      text-align: center;
      margin-top: 10vh;
    }

    h1 {
      margin-bottom: 2rem;
      font-size: 2.5rem;
      color: #0f766e;
    }

    .voice-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border: none;
      border-radius: 9999px;
      padding: 1.25rem 2rem;
      font-weight: 600;
      font-size: 1.1rem;
      cursor: pointer;
      color: #fff;
      background: #16a34a; /* green */
      transition: background 0.2s ease, transform 0.1s ease;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    .voice-btn:active {
      transform: translateY(1px);
    }

    .voice-btn.active {
      background: #dc2626; /* red */
    }

    .icon {
      width: 2rem;
      height: 2rem;
      margin-right: 0.75rem;
    }

    .voice-status {
      margin-top: 1.5rem;
      font-size: 1.2rem;
      font-weight: 600;
      color: #374151;
    }

    #net-status {
      font-weight: 500;
    }
  </style>
</head>

<body>
  <main class="container">
    <h1>NeuroToolkit</h1>

    <button id="voice-btn" class="voice-btn" aria-pressed="false">
      <svg class="icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
        <path d="M12 14a3 3 0 0 0 3-3V6a3 3 0 1 0-6 0v5a3 3 0 0 0 3 3zm5-3a5 5 0 0 1-10 0H5a7 7 0 0 0 6 6.93V21h2v-3.07A7 7 0 0 0 19 11h-2z"/>
      </svg>
      <span id="voice-btn-label">Start Voice Recognition</span>
    </button>

    <div id="voice-status" class="voice-status">Idle</div>

    <hr style="margin: 3rem 0;" />

    <p>Status: <span id="net-status">checkingâ€¦</span></p>
  </main>

  <script type="module">
    // --- Online/offline indicator ---
    const netEl = document.getElementById('net-status');
    function updateNet() { netEl.textContent = navigator.onLine ? 'online' : 'offline'; }
    window.addEventListener('online', updateNet);
    window.addEventListener('offline', updateNet);
    updateNet();

    // --- Register SW (PWA) ---
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js?v=4');
    }

    // --- Voice recognition logic ---
    const btn = document.getElementById('voice-btn');
    const btnLabel = document.getElementById('voice-btn-label');
    const statusEl = document.getElementById('voice-status');

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = SpeechRecognition ? new SpeechRecognition() : null;

    if (recognition) {
      recognition.continuous = true;
      recognition.interimResults = false;
      recognition.lang = navigator.language || 'en-US';
      recognition.onstart = () => setStatus('Voice recognition active');
      recognition.onend = () => {
        if (!isActive) setStatus('Idle');
      };
      recognition.onerror = () => {};
    }

    let isActive = false;

    function setStatus(text) {
      statusEl.textContent = text;
    }

    function toggleVoice() {
      isActive = !isActive;
      btn.classList.toggle('active', isActive);
      btn.setAttribute('aria-pressed', String(isActive));
      if (isActive) {
        btnLabel.textContent = 'Stop Voice Recognition';
        setStatus('Voice recognition active');
        if (recognition) {
          try { recognition.start(); } catch {}
        }
      } else {
        btnLabel.textContent = 'Start Voice Recognition';
        setStatus('Idle');
        if (recognition) {
          try { recognition.stop(); } catch {}
        }
      }
    }

    btn.addEventListener('click', toggleVoice);
  </script>
</body>
</html>
